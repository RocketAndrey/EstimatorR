@page
@model Estimator.Pages.CustomerRequests.ReportModel

@{
    ViewData["Title"] = "Details";
}

<div>
    <h4>Расчёт стоимости испытаний
  
            <a asp-page="./Report" asp-route-id="@Model.CustomerRequest.CustomerRequestID" asp-route-mode="1">По группам</a>&nbsp;|&nbsp;
            <a asp-page="./Report" asp-route-id="@Model.CustomerRequest.CustomerRequestID" asp-route-mode="2">По типам</a>&nbsp;|&nbsp;
            <a asp-page="./Report" asp-route-id="@Model.CustomerRequest.CustomerRequestID" asp-route-mode="3">По испытаниям</a>
    </h4>
    <br />

    <dl class="row">
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.CustomerRequest.RequestNumber)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.CustomerRequest.RequestNumber)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.CustomerRequest.RequestDate)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.CustomerRequest.RequestDate)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.CustomerRequest.Description)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.CustomerRequest.Description)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.CustomerRequest.Program)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.CustomerRequest.Program.Description)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.CustomerRequest.Customer.Name)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.CustomerRequest.Customer.Name)
        </dd>
    </dl>

</div>

    <h4>Сведения о перечне ЭКБ:</h4>
    <br />
    <table class="table">

        <tr>
            <th>@Html.DisplayNameFor(model => model.CustomerRequest.RequestElementTypes.ToList()[0].ElementType.Name)</th>
            <th>@Html.DisplayNameFor(model => model.CustomerRequest.RequestElementTypes.ToList()[0].BatchCount)</th>
            <th>@Html.DisplayNameFor(model => model.CustomerRequest.RequestElementTypes.ToList()[0].ItemCount)</th>
            <th>@Html.DisplayNameFor(model => model.CustomerRequest.RequestElementTypes.ToList()[0].KitCount)</th>
        </tr>

        @foreach (var item in Model.CustomerRequest.RequestElementTypes)
        {
            <tr>
                <td>
                    @item.ElementType.Name
                </td>
                <td>
                    @item.BatchCount
                </td>
                <td>
                    @item.ItemCount
                </td>
                <td>
                    @item.KitCount
                </td>
            </tr>

        }

    </table>

@if (Model.Mode == 2)
{
    <h4>Трудоёмкость по типам ЭКБ:</h4>
    <br />
    <table class="table">

        <tr>
            <th>@Html.DisplayNameFor(model => model.CustomerRequest.RequestElementTypes.ToList()[0].ElementType.Name)</th>
            
            @foreach (var itemOG in Model.CustomerRequest.RequestElementTypes.ToList()[0].QualificationLaborSummary)
            {
                <th>
                    @itemOG.Key.ToString()
                </th>
            }

            <th>@Html.DisplayNameFor(model => model.CustomerRequest.RequestElementTypes.ToList()[0].LaborSummary)</th>
        </tr>

        @foreach (var item in Model.CustomerRequest.RequestElementTypes)
        {
            <tr>
                <td>
                    @item.ElementType.Name
                </td>
                    @foreach (var itemQ in item.QualificationLaborSummary)
                    {
                        <td>
                             @String.Format("{0:0.00}", itemQ.Value.LaborSummary/60)

                        </td>
                     }
            <td>
                @String.Format("{0:0.00}", item.LaborSummary)

            </td>
            </tr>

        }
        <tfoot >
            <tr class="thead-dark">
                <td>Итого:</td>
                @foreach (var itemOG in Model.CustomerRequest.RequestElementTypes.ToList()[0].QualificationLaborSummary)
                {
            <td>
                @String.Format("{0:0.00}", itemOG.Value.GetRequestQualificationLaborSummary(Model.CustomerRequest) / 60)
            </td>
                }
                <td>

                </td>
            </tr>

        </tfoot>

    </table>
}
@if (Model.Mode == 1)
{
<h4>Трудоёмкость по группам испытаний:</h4>
<br />
<table class="table">

    <tr>
        <th>@Html.DisplayNameFor(model => model.CustomerRequest.OperationGroups[0].Name)</th>
        @foreach (var itemOG in Model.CustomerRequest.OperationGroups[0].QualificationLaborSummary)
        {
            <th>
                @itemOG.Name
            </th>
        }

        <th>@Html.DisplayNameFor(model => model.CustomerRequest.OperationGroups[0].LaborSummary)</th>
    </tr>

    @foreach (var item in Model.CustomerRequest.OperationGroups)
    {
        <tr>
            <td>
                @item.Name
            </td>
            @foreach (var itemOG in item.QualificationLaborSummary)
            {
                <td>
                    @String.Format("{0:0.00}", itemOG.LaborSummary / 60)
                </td>
            }
            <td>
                @String.Format("{0:0.00}", item.LaborSummary)
            </td>

        </tr>

    }
    <tfoot>
    <tfoot>
        <tr class="thead-dark">
            <td>Итого:</td>
            @foreach (var itemOG in Model.CustomerRequest.RequestElementTypes.ToList()[0].QualificationLaborSummary)
            {
                <td>
                    @String.Format("{0:0.00}", itemOG.Value.GetRequestQualificationLaborSummary(Model.CustomerRequest) / 60)
                </td>
            }
            <td>
            </td>
        </tr>

    </tfoot>

    </tfoot>

</table>
}
<form method="post" enctype="multipart/form-data">

    <a asp-page="./Edit" asp-route-id="@Model.CustomerRequest.CustomerRequestID">Edit</a> |
    <a asp-page="./Index">Back to List</a>
</form>
